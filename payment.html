<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pembayaran â€” Unlock Skill</title>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}

.container{
  max-width:600px;
  margin:60px auto;
  padding:20px;
}

.card{
  background:rgba(255,255,255,.08);
  border-radius:20px;
  padding:30px;
}

h1, h2 {
  margin: 25px 0;
}

.pay-box img{
  width:220px;
  border-radius:12px;
  background:#fff;
  padding:10px;
}

.btn{
  width:100%;
  padding:16px;
  background:#ff3d00;
  border:none;
  border-radius:30px;
  color:#fff;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
}
.btn:hover{opacity:.9}

.note{
  font-size:14px;
  opacity:.8;
  margin-top:15px;
  text-align:center;
}
  .invoice-box{
  border:3px solid #1ea7e1;
  border-radius:14px;
  padding:18px;
  margin-bottom:20px;
}

.invoice-row{
  display:flex;
  justify-content:space-between;
  margin:10px 0;
}

.invoice-total{
  font-size:18px;
}
  -align:center}
p{line-height:1.6}

.detail{
  margin:20px 0;
}
.detail div{
  margin-bottom:10px;
}

.highlight{
  font-weight:bold;
  color:#00ff99;
}

.pay-box{
  background:#000;
  border-radius:16px;
  padding:20px;
  text-align:center;
  margin-bottom:20px;
}

    .btn-pay {
  width: 90%;
  max-width: 360px;
  padding: 18px;
  font-size: 20px;
  font-weight: bold;
  background: #ff8c00; /* orange terang */
  color: #000;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  box-shadow: 0 6px 15px rgba(255, 140, 0, 0.4);
}

.btn-pay:hover {
  background: #ffa733;
}
</style>
  <script 
  src="https://app.sandbox.midtrans.com/snap/snap.js"
  data-client-key="Mid-client-A-6ElWrkPb-HIJLU">
</script>
</head>

<body>

<div class="container">
<div class="card">

<h1>ðŸ’³ Pembayaran</h1>
<p>Silakan lakukan pembayaran sesuai detail di bawah ini</p>

<div class="detail">
  <div>Nama: <span class="highlight" id="name"></span></div>
  <div>Email: <span class="highlight" id="email"></span></div>
  <div>No WhatsApp: <span class="highlight" id="phone"></span></div>
  <div>Produk: <b>8jt Produk Digital â€“ Akses Seumur Hidup</b></div>
  <div>Harga: <span class="highlight">Rp 89.000</span></div>
  <div>Metode: <span class="highlight" id="payment"></span></div>
</div>

<div style="
  background:rgba(0,0,0,.25);
  padding:14px 16px;
  border-radius:12px;
  margin-bottom:18px;
  font-size:14px;
  line-height:1.6
">
  <div>âœ… <b>Akses seluruh file akan terkirim ke email</b></div>
  <div>Anda dalam hitungan detik setelah payment</div>
</div>
  
<div class="invoice-box">

  <h3>Rincian Pesanan</h3>

  <div class="invoice-row">
    <span>8 Juta++ Produk Digital (PLR, MRR)</span>
    <span>Rp 89.000</span>
  </div>

  <div class="invoice-row" id="resellerRow" style="display:none">
    <span>Reseller Power Kit</span>
    <span>Rp 29.000</span>
  </div>

  <hr>

  <div class="invoice-row invoice-total">
    <b>Total</b>
    <span id="totalPrice"></span>
  </div>

</div>
  
<div class="pay-box" id="payBox">
  <p style="font-size:15px; line-height:1.6">
    ðŸ”’ Akses hampir selesai!<br>
    Klik <b>Bayar Sekarang</b> untuk menyelesaikan pembayaran
    dan <b>akses langsung dikirim ke email</b>.
  </p>
</div>

  
  
<div style="text-align:center; margin-top:30px;">
  <button id="payBtn" class="btn-pay">
    ðŸ”¥ Bayar Sekarang
  </button>
</div>
  
<p class="note">
Setelah klik tombol di atas, kamu akan diarahkan ke halaman konfirmasi.
</p>

</div>
</div>

<script>
const name = localStorage.getItem("order_name");
const email = localStorage.getItem("order_email");
const phone = localStorage.getItem("order_phone");
const pay = localStorage.getItem("order_payment");
const reseller = localStorage.getItem("order_reseller");

document.getElementById("name").innerText = name || "-";
document.getElementById("email").innerText = email || "-";
document.getElementById("phone").innerText = phone || "-";
document.getElementById("payment").innerText = pay ? pay.toUpperCase() : "-";

let total = 89000;

if (reseller === "yes") {
  document.getElementById("resellerRow").style.display = "flex";
  total += 29000;
}

document.getElementById("totalPrice").innerText =
  "Rp " + total.toLocaleString("id-ID");



</script>
  
<script>
document.getElementById("payBtn").addEventListener("click", function () {

  console.log("Klik bayar terdeteksi");

  // ambil data dari localStorage
  const name = localStorage.getItem("order_name");
  const email = localStorage.getItem("order_email");
  const reseller = localStorage.getItem("order_reseller");

  let total = 89000;
  if (reseller === "yes") {
    total += 29000;
  }

  console.log("TOTAL:", total);

  fetch("https://unlockskill-backend.vercel.app/api/create-transaction", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      order_id: "ORDER-" + Date.now(),
      gross_amount: total,
      name: name,
      email: email
    })
  })
  .then(res => res.json())
  .then(data => {
    console.log("RESPON BACKEND:", data);

    if (!data.token) {
      alert("Token Midtrans tidak ditemukan");
      return;
    }

    snap.pay(data.token, {
      onSuccess: function (result) {
        console.log("SUCCESS", result);
        window.location.href = "success.html";
      },
      onPending: function () {
        alert("Pembayaran belum selesai");
      },
      onError: function () {
        alert("Pembayaran gagal");
      },
      onClose: function () {
        alert("Popup ditutup");
      }
    });
  })
  .catch(err => {
    console.error("ERROR:", err);
    alert("Gagal menghubungi server");
  });

});
</script>
</body>
</html>
